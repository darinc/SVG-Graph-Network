!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.GraphNetwork=e():t.GraphNetwork=e()}(this,function(){return function(){"use strict";var t={d:function(e,s){for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}},e={};t.d(e,{default:function(){return h}});class s{constructor(t=0,e=0){this.x=t,this.y=e}add(t){return new s(this.x+t.x,this.y+t.y)}subtract(t){return new s(this.x-t.x,this.y-t.y)}multiply(t){return new s(this.x*t,this.y*t)}divide(t){if(0===t)throw new Error("Division by zero");return new s(this.x/t,this.y/t)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.magnitude();if(0===t)throw new Error("Cannot normalize zero vector");return new s(this.x/t,this.y/t)}static distance(t,e){const s=t.x-e.x,i=t.y-e.y;return Math.sqrt(s*s+i*i)}}class i{constructor(t,e=800,i=600){this.data=t,this.position=new s(Math.random()*e,Math.random()*i),this.velocity=new s,this.force=new s,this.size=void 0!==t.size?t.size:20,this.isFixed=!1,this.dynamicWidth=null,this.dynamicHeight=null}resetPosition(t,e){this.isFixed||(this.position=new s(Math.random()*t,Math.random()*e),this.velocity=new s)}fix(){this.isFixed=!0,this.velocity=new s}unfix(){this.isFixed=!1}}class n{constructor(t={}){this.config={damping:.95,repulsionStrength:6500,attractionStrength:.001,groupingStrength:.001,...t}}updateConfig(t){this.config={...this.config,...t}}updateForces(t,e,i=null){const n=Array.from(t.values());n.forEach(t=>t.force=new s);for(let t=0;t<n.length;t++)for(let e=t+1;e<n.length;e++){const s=n[t],o=n[e];(!i||i.has(s.data.id)&&i.has(o.data.id))&&(this._calculateRepulsionForce(s,o),this._calculateGroupingForce(s,o))}e.forEach(t=>{(!i||i.has(t.source.data.id)&&i.has(t.target.data.id))&&this._calculateAttractionForce(t.source,t.target)})}updatePositions(t,e=null){Array.from(t.values()).forEach(t=>{t.isFixed||e&&!e.has(t.data.id)||(t.velocity=t.velocity.add(t.force.multiply(1)),t.velocity=t.velocity.multiply(this.config.damping),t.position=t.position.add(t.velocity.multiply(1)))})}_calculateRepulsionForce(t,e){const s=t.position.subtract(e.position),i=s.magnitude();if(0===i)return;const n=s.normalize().multiply(this.config.repulsionStrength/(i*i));t.force=t.force.add(n),e.force=e.force.subtract(n)}_calculateGroupingForce(t,e){if(t.data.type===e.data.type&&this.config.groupingStrength>0){const s=t.position.subtract(e.position),i=s.magnitude();if(0===i)return;const n=s.normalize().multiply(-this.config.groupingStrength*i);t.force=t.force.add(n),e.force=e.force.subtract(n)}}_calculateAttractionForce(t,e){const s=t.position.subtract(e.position),i=s.magnitude();if(0===i)return;const n=s.normalize().multiply(this.config.attractionStrength*i);t.force=t.force.subtract(n),e.force=e.force.add(n)}getConfig(){return{...this.config}}resetForces(t){Array.from(t.values()).forEach(t=>t.force=new s)}}class o{constructor(t,e={},s={}){this.container=t,this.config=e,this.callbacks=s,this.titleElement=null,this.breadcrumbsElement=null,this.legendElement=null,this.controls=null,this.settingsPanel=null,this.mobileControls=null,this.zoomInButton=null,this.zoomOutButton=null,this.resetButton=null,this.themeToggle=null,this.settingsToggle=null,this.settingsVisible=!1}initialize(){this.createTitle(),this.createBreadcrumbs(),this.createLegend(),this.createControls(),this.createSettingsPanel()}setElementClass(t,e){try{t.className=e}catch(s){t.classList.add(e)}}createTitle(){this.config.showTitle&&(this.titleElement=document.createElement("h2"),this.setElementClass(this.titleElement,"graph-network-title"),this.titleElement.textContent=this.config.title||"Graph Network",this.container.appendChild(this.titleElement))}createBreadcrumbs(){this.config.showBreadcrumbs&&(this.breadcrumbsElement=document.createElement("div"),this.setElementClass(this.breadcrumbsElement,"graph-network-breadcrumbs"),this.container.appendChild(this.breadcrumbsElement))}generateLegendItems(t){const e=new Set,s=new Map;return t.forEach(t=>{const i=t.data.type;i&&!e.has(i)&&(e.add(i),s.set(i,{type:i,shape:t.data.shape||"circle",color:this.getNodeTypeColor(i)}))}),Array.from(s.values())}getNodeTypeColor(t){return{primary:"#E53E3E",secondary:"#4299E1",tertiary:"#38A169",auxiliary:"#ED8936",major_power:"#E53E3E",regional_power:"#4299E1",small_nation:"#38A169",territory:"#ED8936"}[t]||"#666666"}createLegend(t=[]){if(this.config.showLegend){if(!this.legendElement){this.legendElement=document.createElement("div"),this.setElementClass(this.legendElement,"graph-network-legend");const t=document.createElement("div");this.setElementClass(t,"graph-network-legend-header"),t.textContent="Node Types";const e=document.createElement("button");this.setElementClass(e,"graph-network-legend-toggle"),e.textContent="âˆ’",e.addEventListener("click",()=>this.toggleLegend()),t.appendChild(e),this.legendElement.appendChild(t);const s=document.createElement("div");this.setElementClass(s,"graph-network-legend-content"),this.legendElement.appendChild(s),this.container.appendChild(this.legendElement)}this.updateLegend(t)}}updateLegend(t){if(!this.legendElement)return;const e=this.legendElement.querySelector(".graph-network-legend-content");if(!e)return;const s=this.generateLegendItems(t);e.innerHTML="",s.forEach(t=>{const s=document.createElement("div");this.setElementClass(s,"graph-network-legend-item");const i=document.createElement("div");this.setElementClass(i,`graph-network-legend-shape graph-network-legend-${t.shape}`),i.style.backgroundColor=t.color;const n=document.createElement("span");n.textContent=t.type.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()),s.appendChild(i),s.appendChild(n),e.appendChild(s)})}toggleLegend(){if(!this.legendElement)return;const t=this.legendElement.querySelector(".graph-network-legend-toggle");this.legendElement.classList.contains("minimized")?(this.legendElement.classList.remove("minimized"),t.textContent="âˆ’"):(this.legendElement.classList.add("minimized"),t.textContent="+")}createControls(){this.config.showControls&&(this.controls=document.createElement("div"),this.setElementClass(this.controls,"graph-network-controls"),this.mobileControls=document.createElement("div"),this.setElementClass(this.mobileControls,"graph-network-mobile-controls"),this.createZoomButtons(),this.createUtilityButtons(),this.controls.appendChild(this.mobileControls),this.controls.appendChild(this.themeToggle),this.controls.appendChild(this.settingsToggle),this.container.appendChild(this.controls))}createZoomButtons(){this.zoomInButton=document.createElement("button"),this.setElementClass(this.zoomInButton,"graph-network-zoom-button graph-network-zoom-in"),this.zoomInButton.textContent="+",this.zoomInButton.addEventListener("click",()=>{this.callbacks.onZoomIn&&this.callbacks.onZoomIn()}),this.zoomOutButton=document.createElement("button"),this.setElementClass(this.zoomOutButton,"graph-network-zoom-button graph-network-zoom-out"),this.zoomOutButton.textContent="âˆ’",this.zoomOutButton.addEventListener("click",()=>{this.callbacks.onZoomOut&&this.callbacks.onZoomOut()}),this.resetButton=document.createElement("button"),this.setElementClass(this.resetButton,"graph-network-reset-view-button"),this.resetButton.textContent="âŠ™",this.resetButton.addEventListener("click",()=>{this.callbacks.onResetView&&this.callbacks.onResetView()}),this.mobileControls.appendChild(this.zoomInButton),this.mobileControls.appendChild(this.zoomOutButton),this.mobileControls.appendChild(this.resetButton)}createUtilityButtons(){this.themeToggle=document.createElement("button"),this.setElementClass(this.themeToggle,"graph-network-theme-toggle"),this.themeToggle.textContent="light"===this.config.theme?"ðŸŒ™":"ðŸŒž",this.themeToggle.addEventListener("click",()=>{this.callbacks.onToggleTheme&&this.callbacks.onToggleTheme()}),this.settingsToggle=document.createElement("button"),this.setElementClass(this.settingsToggle,"graph-network-settings-toggle"),this.settingsToggle.textContent="^",this.settingsToggle.addEventListener("click",()=>this.toggleSettings())}createSettingsPanel(){if(!this.config.showControls)return;this.settingsPanel=document.createElement("div"),this.setElementClass(this.settingsPanel,"graph-network-settings");const t=document.createElement("h3");t.textContent="Physics Settings",this.settingsPanel.appendChild(t),this.createPhysicsControls(),this.settingsPanel.addEventListener("click",t=>{t.stopPropagation()}),this.container.appendChild(this.settingsPanel)}createPhysicsControls(){[{key:"damping",label:"Damping",min:0,max:20,step:.5,value:10,description:"Velocity decay factor"},{key:"repulsionStrength",label:"Repulsion",min:0,max:20,step:.5,value:13,description:"Node repulsion force"},{key:"attractionStrength",label:"Attraction",min:0,max:20,step:.1,value:10,description:"Link attraction force"},{key:"groupingStrength",label:"Grouping",min:0,max:20,step:.5,value:10,description:"Same-type grouping force"},{key:"filterDepth",label:"Filter Depth",min:1,max:5,step:1,value:1,description:"Connection levels to show when filtering"}].forEach(t=>{const e=document.createElement("div");this.setElementClass(e,"graph-network-control");const s=document.createElement("label");s.textContent=t.label;const i=document.createElement("input");i.type="range",i.min=t.min,i.max=t.max,i.step=t.step,i.value=t.value;const n=document.createElement("span");this.setElementClass(n,"graph-network-control-value"),n.textContent=t.value.toFixed(1),i.addEventListener("input",e=>{const s=parseFloat(e.target.value),i=this.convertUserValueToPhysics(t.key,s);n.textContent=s.toFixed(1),this.callbacks.onConfigChange&&this.callbacks.onConfigChange(t.key,i)}),e.appendChild(s),e.appendChild(i),e.appendChild(n),this.settingsPanel.appendChild(e)})}toggleSettings(){this.settingsPanel&&(this.settingsVisible=!this.settingsVisible,this.settingsVisible?this.settingsPanel.classList.add("is-open"):this.settingsPanel.classList.remove("is-open"),this.settingsToggle.textContent=this.settingsVisible?"v":"^")}closeSettings(){this.settingsPanel&&this.settingsVisible&&(this.settingsVisible=!1,this.settingsPanel.classList.remove("is-open"),this.settingsToggle&&(this.settingsToggle.textContent="^"))}updateThemeToggle(t){this.themeToggle&&(this.themeToggle.textContent="light"===t?"ðŸŒ™":"ðŸŒž")}renderBreadcrumbs(t){this.breadcrumbsElement&&(this.breadcrumbsElement.innerHTML="",t.forEach((e,s)=>{if(s>0){const t=document.createElement("span");this.setElementClass(t,"graph-network-breadcrumb-separator"),t.textContent=" > ",this.breadcrumbsElement.appendChild(t)}const i=document.createElement("span");this.setElementClass(i,"graph-network-breadcrumb"),s===t.length-1&&i.classList.add("active"),i.textContent=e.name,i.addEventListener("click",()=>{e.action&&this.callbacks.onBreadcrumbClick&&this.callbacks.onBreadcrumbClick(e.action)}),this.breadcrumbsElement.appendChild(i)}))}convertUserValueToPhysics(t,e){const s=parseFloat(e);switch(t){case"damping":if(0===s)return 1;{const t=s/20;return Math.exp(Math.log(1)*(1-t)+Math.log(.35)*t)}case"repulsionStrength":return 500*s;case"attractionStrength":case"groupingStrength":return s/1e4;case"filterDepth":return parseInt(s);default:return s}}updateConfig(t){this.config={...this.config,...t}}destroy(){[this.titleElement,this.breadcrumbsElement,this.legendElement,this.controls,this.settingsPanel].forEach(t=>{t&&t.parentNode&&t.parentNode.removeChild(t)}),this.titleElement=null,this.breadcrumbsElement=null,this.legendElement=null,this.controls=null,this.settingsPanel=null,this.mobileControls=null,this.zoomInButton=null,this.zoomOutButton=null,this.resetButton=null,this.themeToggle=null,this.settingsToggle=null}}class a{constructor(t,e,s={}){this.container=t,this.containerId=e,this.config=s,this.canvas=null,this.svg=null,this.transformGroup=null,this.linkGroup=null,this.nodeGroup=null,this.labelGroup=null,this.nodeElements=new Map,this.linkElements=new Map,this.transformState={x:0,y:0,scale:1},this.textCanvas=null,this.textContext=null}initialize(){this.createSVGContainer(),this.setupTextMeasurement()}createSVGContainer(){const t=this.container.querySelector(".graph-network-canvas");t&&t.remove();const e=this.container.getBoundingClientRect(),s=e.width,i=e.height;this.canvas=document.createElement("div"),this.canvas.className="graph-network-canvas",this.container.appendChild(this.canvas),this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width",s),this.svg.setAttribute("height",i),this.svg.style.display="block",this.svg.style.backgroundColor="var(--bg-primary)",this.transformGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.transformGroup.classList.add("transform-group"),this.linkGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.linkGroup.classList.add("links"),this.labelGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.labelGroup.classList.add("edge-labels"),this.nodeGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.nodeGroup.classList.add("nodes"),this.transformGroup.appendChild(this.linkGroup),this.transformGroup.appendChild(this.labelGroup),this.transformGroup.appendChild(this.nodeGroup),this.svg.appendChild(this.transformGroup),this.createArrowMarker(),this.canvas.appendChild(this.svg)}createArrowMarker(){const t=document.createElementNS("http://www.w3.org/2000/svg","defs"),e=document.createElementNS("http://www.w3.org/2000/svg","marker");e.setAttribute("id",`arrowhead-${this.containerId}`),e.setAttribute("viewBox","0 -5 10 10"),e.setAttribute("refX","8"),e.setAttribute("refY","0"),e.setAttribute("orient","auto"),e.setAttribute("markerUnits","strokeWidth");const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d","M0,-5L10,0L0,5"),s.setAttribute("fill","#5a5a5a"),e.appendChild(s),t.appendChild(e),this.svg.appendChild(t)}setupTextMeasurement(){this.textCanvas=document.createElement("canvas"),this.textContext=this.textCanvas.getContext("2d"),this.textContext.font="14px Arial"}measureTextWidth(t){return this.textContext?this.textContext.measureText(t).width:8*t.length}createElements(t,e){this.linkGroup&&this.labelGroup&&this.nodeGroup||this.createSVGContainer(),this.clearElements(),this.createLinkElements(e),this.createNodeElements(t)}createLinkElements(t){this.linkGroup&&this.labelGroup&&t.forEach(t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","line");e.classList.add("link"),e.setAttribute("marker-end",`url(#arrowhead-${this.containerId})`),t.weight&&(e.style.strokeWidth=`${t.weight}px`),"dashed"===t.line_type?e.style.strokeDasharray="5, 5":"dotted"===t.line_type&&(e.style.strokeDasharray="2, 2"),this.linkGroup.appendChild(e);const s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.classList.add("edge-label-background"),this.labelGroup.appendChild(s);const i=document.createElementNS("http://www.w3.org/2000/svg","text");i.textContent=t.label||"",i.classList.add("edge-label-text"),this.labelGroup.appendChild(i),this.linkElements.set(t,{linkEl:e,labelText:i,labelBackground:s})})}createNodeElements(t){this.nodeGroup&&Array.from(t.values()).forEach(t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttribute("data-id",t.data.id);const{shapeElement:s,hiddenIndicator:i}=this.createNodeShape(t),n=this.createNodeText(t);i&&e.appendChild(i),e.appendChild(s),e.appendChild(n),this.nodeGroup.appendChild(e),this.nodeElements.set(t,{group:e,shape:s,text:n,hiddenIndicator:i})})}createNodeShape(t){let e,s=null;switch(t.data.shape){case"rectangle":const i=this.measureTextWidth(t.data.name),n=20,o=2*t.size,a=Math.max(o,i+n),r=1.4*t.size;t.dynamicWidth=a,t.dynamicHeight=r;const h=4;s=document.createElementNS("http://www.w3.org/2000/svg","rect"),s.setAttribute("x",-(a+h)/2),s.setAttribute("y",-(r+h)/2),s.setAttribute("width",a+h),s.setAttribute("height",r+h),s.setAttribute("rx",5),s.classList.add("hidden-connection-indicator"),s.style.display="none",e=document.createElementNS("http://www.w3.org/2000/svg","rect"),e.setAttribute("x",-a/2),e.setAttribute("y",-r/2),e.setAttribute("width",a),e.setAttribute("height",r),e.setAttribute("rx",5);break;case"square":const l=1.4*t.size;e=document.createElementNS("http://www.w3.org/2000/svg","rect"),e.setAttribute("x",-l/2),e.setAttribute("y",-l/2),e.setAttribute("width",l),e.setAttribute("height",l),e.setAttribute("rx",5);break;case"triangle":const c=1.4*t.size,d=c*Math.sqrt(3)/2,g=[[0,-d/2],[-c/2,d/2],[c/2,d/2]].map(t=>t.join(",")).join(" ");e=document.createElementNS("http://www.w3.org/2000/svg","polygon"),e.setAttribute("points",g);break;default:e=document.createElementNS("http://www.w3.org/2000/svg","circle"),e.setAttribute("r",t.size)}return e.classList.add("node"),e.classList.add(`node-${t.data.type}`),e.setAttribute("data-type",t.data.type),{shapeElement:e,hiddenIndicator:s}}createNodeText(t){const e=document.createElementNS("http://www.w3.org/2000/svg","text");return e.textContent=t.data.name,e.classList.add("node-label"),e.setAttribute("text-anchor","middle"),e.setAttribute("dominant-baseline","central"),e}render(t,e,s=null){this.transformGroup.style.transform=`translate(${this.transformState.x}px, ${this.transformState.y}px) scale(${this.transformState.scale})`,this.updateLinkPositions(e,s),this.updateNodePositions(t,s)}updateLinkPositions(t,e=null){t.forEach(t=>{const s=this.linkElements.get(t);if(!s)return;const i=!e||e.has(t.source.data.id)&&e.has(t.target.data.id);s.linkEl.style.opacity=i?"1":"0.1",s.labelText.style.opacity=i?"1":"0.1",s.labelBackground.style.opacity=i?"1":"0.1";const n=t.source.position,o=t.target.position,a=o.subtract(n),r=a.magnitude();let h=o.x,l=o.y;if("rectangle"===t.target.data.shape&&r>0){const e=(t.target.dynamicWidth||2.8*t.target.size)/2,s=(t.target.dynamicHeight||1.4*t.target.size)/2,i=Math.atan2(a.y,a.x),n=Math.abs(i);let r=e,c=s;n>Math.atan2(s,e)&&n<Math.PI-Math.atan2(s,e)?r=s/Math.tan(n):c=e*Math.tan(n),h=o.x-r*Math.sign(a.x),l=o.y-c*Math.sign(a.y)}else if("circle"===t.target.data.shape&&r>t.target.size){const e=(r-t.target.size)/r;h=n.x+a.x*e,l=n.y+a.y*e}s.linkEl.setAttribute("x1",n.x),s.linkEl.setAttribute("y1",n.y),s.linkEl.setAttribute("x2",h),s.linkEl.setAttribute("y2",l);const c=(n.x+h)/2,d=(n.y+l)/2;s.labelText.setAttribute("x",c),s.labelText.setAttribute("y",d),this.updateLabelBackground(s.labelText,s.labelBackground)})}updateLabelBackground(t,e){if(e&&t.textContent)try{const s=t.getBBox(),i=4;e.setAttribute("x",s.x-i),e.setAttribute("y",s.y-i),e.setAttribute("width",s.width+2*i),e.setAttribute("height",s.height+2*i)}catch(t){console.warn("Could not get text bounding box:",t)}}updateNodePositions(t,e=null){Array.from(t.values()).forEach(t=>{const s=this.nodeElements.get(t);if(s){s.group.setAttribute("transform",`translate(${t.position.x},${t.position.y})`);const i=!e||e.has(t.data.id);s.group.style.opacity=i?"1":"0.1"}})}setTransform(t,e,s){this.transformState.x=t,this.transformState.y=e,this.transformState.scale=s}getTransform(){return{...this.transformState}}resize(t,e){this.svg&&(this.svg.setAttribute("width",t),this.svg.setAttribute("height",e))}clearElements(){this.linkGroup&&(this.linkGroup.innerHTML=""),this.labelGroup&&(this.labelGroup.innerHTML=""),this.nodeGroup&&(this.nodeGroup.innerHTML=""),this.nodeElements.clear(),this.linkElements.clear()}getSVGElement(){return this.svg}getNodeElements(){return this.nodeElements}getLinkElements(){return this.linkElements}destroy(){this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.clearElements(),this.canvas=null,this.svg=null,this.transformGroup=null,this.linkGroup=null,this.nodeGroup=null,this.labelGroup=null,this.textCanvas=null,this.textContext=null}}class r{constructor(t={}){this.config=t,this.eventCallbacks=new Map,this.isDragging=!1,this.isPanning=!1,this.isPinching=!1,this.dragNode=null,this.wasNodeFixed=!1,this.lastTouchTime=0,this.touchStartTime=0,this.lastTouchEndTime=0,this.touchTarget=null,this.dragStartPosition=null,this.lastPinchDistance=0,this.transformState={x:0,y:0,scale:1},this.svg=null,this.nodes=null,this.callbacks={}}initialize(t,e){this.svg=t,this.nodes=e,this.setupEventListeners()}setupEventListeners(){this.svg&&(this.setupNodeEventListeners(),this.svg.addEventListener("mousedown",t=>this.handleSvgMouseDown(t)),this.svg.addEventListener("mousemove",t=>this.handleSvgMouseMove(t)),this.svg.addEventListener("mouseup",()=>this.handleSvgMouseUp()),this.svg.addEventListener("dblclick",t=>this.handleSvgDoubleClick(t)),this.svg.addEventListener("wheel",t=>this.handleWheel(t)),this.svg.addEventListener("touchstart",t=>this.handleTouchStart(t),{passive:!1}),this.svg.addEventListener("touchmove",t=>this.handleTouchMove(t),{passive:!1}),this.svg.addEventListener("touchend",t=>this.handleTouchEnd(t),{passive:!1}),this.svg.addEventListener("touchcancel",t=>this.handleTouchEnd(t),{passive:!1}),window.addEventListener("resize",()=>this.handleResize()))}setupNodeEventListeners(){if(!this.nodes||!this.callbacks.getNodeElements)return;const t=this.callbacks.getNodeElements();this.nodes.forEach(e=>{const s=t.get(e);s&&(s.group.addEventListener("mousedown",t=>{this.handleNodeMouseDown(t,e)}),s.group.addEventListener("dblclick",t=>{this.handleNodeDoubleClick(t,e)}),s.group.addEventListener("touchstart",t=>{this.handleNodeTouchStart(t,e)}))})}handleNodeMouseDown(t,e){t.preventDefault(),this.isDragging=!0,this.dragNode=e,this.wasNodeFixed=e.isFixed,this.callbacks.fixNode&&this.callbacks.fixNode(e),this.emit("nodeMouseDown",{node:e,event:t})}handleNodeDoubleClick(t,e){t.preventDefault(),t.stopPropagation(),this.callbacks.filterByNode&&this.callbacks.filterByNode(e.data.id),this.emit("nodeDoubleClick",{node:e,event:t})}handleSvgMouseDown(t){this.isDragging||(this.callbacks.closeSettings&&this.callbacks.closeSettings(),this.isPanning=!0,this.lastMouseX=t.clientX,this.lastMouseY=t.clientY)}handleSvgDoubleClick(t){t.preventDefault(),this.callbacks.resetFilter&&this.callbacks.resetFilter(),this.emit("backgroundDoubleClick",{event:t})}handleSvgMouseMove(t){this.isDragging&&this.dragNode?this.handleNodeDrag(t):this.isPanning&&this.handlePan(t)}handleNodeDrag(t){if(!this.svg||!this.dragNode)return;const e=this.svg.getBoundingClientRect(),s=(t.clientX-e.left-this.transformState.x)/this.transformState.scale,i=(t.clientY-e.top-this.transformState.y)/this.transformState.scale;this.dragNode.position.x=s,this.dragNode.position.y=i,this.callbacks.showTooltip&&this.callbacks.showTooltip(this.dragNode,{x:t.clientX+10,y:t.clientY+10})}handlePan(t){const e=t.clientX-this.lastMouseX,s=t.clientY-this.lastMouseY;this.transformState.x+=e,this.transformState.y+=s,this.callbacks.updateTransform&&this.callbacks.updateTransform(this.transformState.x,this.transformState.y,this.transformState.scale),this.lastMouseX=t.clientX,this.lastMouseY=t.clientY}handleSvgMouseUp(){this.isDragging&&this.dragNode&&!this.wasNodeFixed&&this.callbacks.unfixNode&&this.callbacks.unfixNode(this.dragNode),this.isDragging=!1,this.dragNode=null,this.isPanning=!1,this.wasNodeFixed=!1,this.callbacks.hideTooltip&&this.callbacks.hideTooltip()}handleWheel(t){t.preventDefault();const e=this.svg.getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top,n=t.deltaY>0?1/this.config.zoomSensitivity:this.config.zoomSensitivity,o=Math.max(.2,Math.min(2,this.transformState.scale*n)),a=o/this.transformState.scale;this.transformState.x=s-(s-this.transformState.x)*a,this.transformState.y=i-(i-this.transformState.y)*a,this.transformState.scale=o,this.callbacks.updateTransform&&this.callbacks.updateTransform(this.transformState.x,this.transformState.y,this.transformState.scale),this.emit("zoom",{scale:this.transformState.scale,x:this.transformState.x,y:this.transformState.y})}handleTouchStart(t){t.preventDefault(),this.touchStartTime=Date.now();const e=t.touches;if(1===e.length){const t=e[0];this.lastTouchX=t.clientX,this.lastTouchY=t.clientY;const s=document.elementFromPoint(t.clientX,t.clientY),i=s?.closest("g[data-id]");if(i){const t=i.getAttribute("data-id"),e=this.nodes.get(t);e&&(this.touchTarget={type:"node",node:e,element:i})}else this.callbacks.closeSettings&&this.callbacks.closeSettings(),this.touchTarget={type:"background"},this.isPanning=!0}else if(2===e.length){this.isPinching=!0,this.isPanning=!1;const t=e[0],s=e[1];this.lastPinchDistance=Math.sqrt(Math.pow(s.clientX-t.clientX,2)+Math.pow(s.clientY-t.clientY,2)),this.lastPinchCenterX=(t.clientX+s.clientX)/2,this.lastPinchCenterY=(t.clientY+s.clientY)/2}}handleNodeTouchStart(t,e){t.preventDefault(),t.touches.length>1||(this.isDragging=!0,this.dragNode=e,this.wasNodeFixed=e.isFixed,this.callbacks.fixNode&&this.callbacks.fixNode(e),this.dragStartPosition={x:e.position.x,y:e.position.y})}handleTouchMove(t){t.preventDefault();const e=t.touches;1===e.length&&this.isDragging&&this.dragNode?this.handleTouchNodeDrag(e[0]):1===e.length&&this.isPanning?this.handleTouchPan(e[0]):2===e.length&&this.isPinching&&this.handleTouchPinch(e)}handleTouchNodeDrag(t){if(!this.svg||!this.dragNode)return;const e=this.svg.getBoundingClientRect(),s=(t.clientX-e.left-this.transformState.x)/this.transformState.scale,i=(t.clientY-e.top-this.transformState.y)/this.transformState.scale;this.dragNode.position.x=s,this.dragNode.position.y=i,this.callbacks.showTooltip&&this.callbacks.showTooltip(this.dragNode,{x:t.clientX+10,y:t.clientY+10})}handleTouchPan(t){const e=t.clientX-this.lastTouchX,s=t.clientY-this.lastTouchY;this.transformState.x+=e,this.transformState.y+=s,this.callbacks.updateTransform&&this.callbacks.updateTransform(this.transformState.x,this.transformState.y,this.transformState.scale),this.lastTouchX=t.clientX,this.lastTouchY=t.clientY}handleTouchPinch(t){const e=t[0],s=t[1],i=Math.sqrt(Math.pow(s.clientX-e.clientX,2)+Math.pow(s.clientY-e.clientY,2)),n=(e.clientX+s.clientX)/2,o=(e.clientY+s.clientY)/2;if(this.lastPinchDistance>0){const t=i/this.lastPinchDistance,e=Math.max(.2,Math.min(2,this.transformState.scale*t)),s=this.svg.getBoundingClientRect(),a=n-s.left,r=o-s.top,h=e/this.transformState.scale;this.transformState.x=a-(a-this.transformState.x)*h,this.transformState.y=r-(r-this.transformState.y)*h,this.transformState.scale=e,this.callbacks.updateTransform&&this.callbacks.updateTransform(this.transformState.x,this.transformState.y,this.transformState.scale)}this.lastPinchDistance=i,this.lastPinchCenterX=n,this.lastPinchCenterY=o}handleTouchEnd(t){const e=Date.now();e-this.touchStartTime<300&&e-this.lastTouchEndTime<500&&this.handleDoubleTap(),this.lastTouchEndTime=e,0===t.touches.length?(this.isDragging&&this.dragNode&&!this.wasNodeFixed&&this.callbacks.unfixNode&&this.callbacks.unfixNode(this.dragNode),this.isDragging=!1,this.dragNode=null,this.dragStartPosition=null,this.isPanning=!1,this.isPinching=!1,this.wasNodeFixed=!1,this.touchTarget=null,this.callbacks.hideTooltip&&this.callbacks.hideTooltip()):1===t.touches.length&&(this.isPinching=!1,this.lastPinchDistance=0)}handleDoubleTap(){"node"===this.touchTarget?.type?(this.callbacks.filterByNode&&this.callbacks.filterByNode(this.touchTarget.node.data.id),this.emit("nodeDoubleClick",{node:this.touchTarget.node})):(this.callbacks.resetFilter&&this.callbacks.resetFilter(),this.emit("backgroundDoubleClick",{}))}handleResize(){this.callbacks.resize&&this.callbacks.resize(),this.emit("resize",{})}setTransform(t,e,s){this.transformState.x=t,this.transformState.y=e,this.transformState.scale=s}getTransform(){return{...this.transformState}}updateConfig(t){this.config={...this.config,...t}}on(t,e){this.eventCallbacks.has(t)||this.eventCallbacks.set(t,[]),this.eventCallbacks.get(t).push(e)}off(t,e){if(this.eventCallbacks.has(t)){const s=this.eventCallbacks.get(t),i=s.indexOf(e);-1!==i&&s.splice(i,1)}}emit(t,e={}){this.eventCallbacks.has(t)&&this.eventCallbacks.get(t).forEach(s=>{try{s(e)}catch(e){console.error(`Error in event callback for '${t}':`,e)}})}destroy(){window.removeEventListener("resize",()=>this.handleResize()),this.eventCallbacks.clear(),this.svg=null,this.nodes=null,this.callbacks={}}}var h=class{constructor(t,e={}){if(this.containerId=t,this.container=document.getElementById(t),!this.container)throw new Error(`Container element with id "${t}" not found.`);this.config={damping:.95,repulsionStrength:6500,attractionStrength:.001,zoomSensitivity:1.01,filterDepth:1,groupingStrength:.001,showControls:!0,showLegend:!0,showTitle:!0,showBreadcrumbs:!0,theme:"dark",title:"Graph Network",...e.config},this.nodes=new Map,this.links=[],this.filteredNodes=null,this.currentFilterNodeId=null,this.animationFrame=null,this.isAnimating=!1,this.setupContainer(),this.initializeModules(),e.data&&this.setData(e.data),this.startAnimation()}setupContainer(){this.container.innerHTML="",this.container.classList.add("graph-network-container"),this.container.setAttribute("data-theme",this.config.theme)}initializeModules(){this.physics=new n({damping:this.config.damping,repulsionStrength:this.config.repulsionStrength,attractionStrength:this.config.attractionStrength,groupingStrength:this.config.groupingStrength}),this.renderer=new a(this.container,this.containerId,this.config),this.renderer.initialize();const t={onZoomIn:()=>this.zoomIn(),onZoomOut:()=>this.zoomOut(),onResetView:()=>this.resetViewAndLayout(),onToggleTheme:()=>this.toggleTheme(),onConfigChange:(t,e)=>this.updatePhysicsConfig(t,e),onBreadcrumbClick:t=>this.handleBreadcrumbAction(t)};this.ui=new o(this.container,this.config,t),this.ui.initialize();const e={getNodeElements:()=>this.renderer.getNodeElements(),fixNode:t=>t.fix(),unfixNode:t=>t.unfix(),filterByNode:t=>{this.currentFilterNodeId===t?this.resetFilter():this.filterByNode(t)},resetFilter:()=>this.resetFilter(),updateTransform:(t,e,s)=>this.renderer.setTransform(t,e,s),showTooltip:(t,e)=>this.showTooltip(t,e),hideTooltip:()=>this.hideTooltip(),closeSettings:()=>this.ui.closeSettings(),resize:()=>this.handleResize()};this.events=new r(this.config),this.eventCallbacks=e,this.createTooltip(),this.setTheme(this.config.theme)}setData(t){this.clearGraph(),this.parseData(t),this.renderer.createElements(this.nodes,this.links),this.events.callbacks=this.eventCallbacks,this.events.initialize(this.renderer.getSVGElement(),this.nodes),this.ui.createLegend(Array.from(this.nodes.values())),this.resetAllNodePositions(),this.physics||(console.log("Re-initializing physics engine"),this.physics=new n({damping:this.config.damping,repulsionStrength:this.config.repulsionStrength,attractionStrength:this.config.attractionStrength,groupingStrength:this.config.groupingStrength})),this.isAnimating||this.startAnimation(),this.updateGraphView(),this.emit("dataLoaded",{nodes:this.nodes.size,links:this.links.length})}parseData(t){const{nodes:e,links:s}=t;if(!Array.isArray(e))throw new Error("Data must contain a nodes array");const n=this.container.getBoundingClientRect(),o=n.width||800,a=n.height||600;if(console.log(`Container dimensions: ${o}x${a}`),e.forEach(t=>{if(!t.id||!t.name)throw new Error("Each node must have an id and name");const e=new i(t,o,a);console.log(`Node ${t.name} created at position: (${e.position.x.toFixed(2)}, ${e.position.y.toFixed(2)})`),this.nodes.set(t.id,e)}),!Array.isArray(s))throw new Error("Data must contain a links array");s.forEach(t=>{const e=this.nodes.get(t.source),s=this.nodes.get(t.target);if(!e||!s)throw new Error(`Link references non-existent node: ${t.source} -> ${t.target}`);this.links.push({source:e,target:s,label:t.label||"",weight:t.weight||1,line_type:t.line_type||"solid"})})}updatePhysicsConfig(t,e){this.config[t]=e,"filterDepth"===t?this.currentFilterNodeId&&this.filterByNode(this.currentFilterNodeId,e):this.physics&&this.physics.updateConfig({[t]:e})}startAnimation(){this.isAnimating||(this.isAnimating=!0,this.animate())}stopAnimation(){this.isAnimating=!1,this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null)}animate(){this.isAnimating&&(this.physics?(this.events.getTransform(),this.events.isPanning||(this.physics.updateForces(this.nodes,this.links,this.filteredNodes),this.physics.updatePositions(this.nodes,this.filteredNodes)),this.renderer.render(this.nodes,this.links,this.filteredNodes),this.animationFrame=requestAnimationFrame(()=>this.animate())):console.error("Physics engine not initialized"))}filterByNode(t,e=null){const s=null!==e?e:this.config.filterDepth,i=this.nodes.get(t);if(!i)throw new Error(`Node with id "${t}" does not exist`);const n=new Set,o=[{node:i,currentDepth:0}];for(;o.length>0;){const{node:t,currentDepth:e}=o.shift();n.has(t.data.id)||e>s||(n.add(t.data.id),this.links.forEach(s=>{s.source!==t||n.has(s.target.data.id)?s.target!==t||n.has(s.source.data.id)||o.push({node:s.source,currentDepth:e+1}):o.push({node:s.target,currentDepth:e+1})}))}this.filteredNodes=n,this.currentFilterNodeId=t,this.updateGraphView();const a=[{name:"All Nodes",action:"reset"},{name:i.data.name,action:null}];this.ui.renderBreadcrumbs(a),this.emit("filtered",{nodeId:t,depth:s,visibleNodes:Array.from(n)})}resetFilter(){this.filteredNodes=null,this.currentFilterNodeId=null,this.updateGraphView(),this.ui.renderBreadcrumbs([{name:"All Nodes",action:null}]),this.emit("filterReset")}updateGraphView(){this.emit("viewUpdated",{filteredNodes:this.filteredNodes?Array.from(this.filteredNodes):null})}resetAllNodePositions(){const t=this.container.getBoundingClientRect(),e=t.width||800,s=t.height||600;this.nodes.forEach(t=>{t.resetPosition(e,s)})}resetViewAndLayout(){this.resetAllNodePositions(),this.renderer.setTransform(0,0,1),this.events.setTransform(0,0,1),this.emit("reset")}zoomIn(){const t=this.events.getTransform(),e=Math.min(2,t.scale*Math.pow(this.config.zoomSensitivity,10)),s=this.container.getBoundingClientRect(),i=s.width/2,n=s.height/2,o=e/t.scale,a=i-(i-t.x)*o,r=n-(n-t.y)*o;this.renderer.setTransform(a,r,e),this.events.setTransform(a,r,e),this.emit("zoom",{scale:e,x:a,y:r})}zoomOut(){const t=this.events.getTransform(),e=Math.max(.2,t.scale/Math.pow(this.config.zoomSensitivity,10)),s=this.container.getBoundingClientRect(),i=s.width/2,n=s.height/2,o=e/t.scale,a=i-(i-t.x)*o,r=n-(n-t.y)*o;this.renderer.setTransform(a,r,e),this.events.setTransform(a,r,e),this.emit("zoom",{scale:e,x:a,y:r})}toggleTheme(){const t="light"===this.config.theme?"dark":"light";this.setTheme(t)}setTheme(t){this.config.theme=t,this.container.setAttribute("data-theme",t),this.ui.updateThemeToggle(t),this.emit("themeChanged",{theme:t})}handleBreadcrumbAction(t){"reset"===t&&this.resetFilter()}handleResize(){const t=this.container.getBoundingClientRect();this.renderer.resize(t.width,t.height),this.emit("resize",{width:t.width,height:t.height})}createTooltip(){this.tooltip=document.createElement("div"),this.tooltip.className="graph-network-tooltip",this.tooltip.style.display="none",document.body.appendChild(this.tooltip)}showTooltip(t,e=null){this.tooltip&&(this.tooltip.innerHTML=`\n            <strong>${t.data.name}</strong><br>\n            Type: ${t.data.type}<br>\n            Position: (${Math.round(t.position.x)}, ${Math.round(t.position.y)})\n        `,e&&(this.tooltip.style.left=`${e.x}px`,this.tooltip.style.top=`${e.y}px`),this.tooltip.style.display="block")}hideTooltip(){this.tooltip&&(this.tooltip.style.display="none")}clearGraph(){this.nodes.clear(),this.links=[],this.filteredNodes=null,this.currentFilterNodeId=null,this.renderer.clearElements()}getNodes(){return Array.from(this.nodes.values()).map(t=>({...t.data}))}getLinks(){return this.links.map(t=>({source:t.source.data.id,target:t.target.data.id,label:t.label,weight:t.weight,line_type:t.line_type}))}getNode(t){const e=this.nodes.get(t);return e?{...e.data}:null}on(t,e){this.events.on(t,e)}off(t,e){this.events.off(t,e)}emit(t,e={}){this.events.emit(t,e)}destroy(){this.stopAnimation(),this.physics=null,this.renderer?.destroy(),this.ui?.destroy(),this.events?.destroy(),this.tooltip&&this.tooltip.parentNode&&this.tooltip.parentNode.removeChild(this.tooltip),this.clearGraph(),this.emit("destroyed")}};return e.default}()});